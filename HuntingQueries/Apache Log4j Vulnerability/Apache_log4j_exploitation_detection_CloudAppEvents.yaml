name: Possible exploitation of Apache log4j component detected
description: |
  'This hunting query looks for possible attempts to exploit a remote code execution vulnerability in the Log4j component of Apache. 
  Attackers may attempt to launch arbitrary code by passing specific commands to a server, which are then logged and executed by the Log4j component.
  For more details on Apache Log4j Remote Code Execution Vulnerability - https://community.riskiq.com/article/505098fc/description
  Find more details on collecting EXECVE data into Microsoft Sentinel - https://techcommunity.microsoft.com/t5/azure-sentinel/hunting-threats-on-linux-with-azure-sentinel/ba-p/1344431'

This query is advised to be tested in M365 Defender where all log sources reside.

tactics:
  - Persistence
  - Execution
relevantTechniques:
  - T1059
  - T1053
tags:
  - CVE-2021-44228
query: |
CloudAppEvents
| where UserAgent contains "jndi:" 
or AccountDisplayName contains "jndi:"
or Application contains "jndi:"
or AdditionalFields contains "jndi:"
| project ActionType, ActivityType, Application, AccountDisplayName, IPAddress, UserAgent, AdditionalFields
version: 1.0.0